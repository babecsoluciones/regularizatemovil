<!DOCTYPE html>
<html lang="zxx">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="icon" href="images/favicon.png">
	<title>Regularízate Móvil</title>

	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="css/materialize.css">
	<link rel="stylesheet" href="css/loaders.css">
	<link rel="stylesheet" href="css/lightbox.css">
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<link rel="stylesheet" href="css/style.css">

</head>
<body>
	
	<!-- navbar -->
	<div class="navbar">
		<div class="container">
			<div class="row">
				<div class="col s9">
					<div class="content-left">
						
					</div>
				</div>
				<div class="col s3">
					<div class="content-right">
						<a href="#slide-out" data-activates="slide-out" class="sidebar"><i class="fa fa-bars"></i></a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end navbar -->
	
	<!-- sidebar -->
	<div class="sidebar-panel">
		<ul id="slide-out" class="collapsible side-nav">
			<li>
				<div class="user-view">
					<div class="background">
						<img src="images/bg-user.jpg" alt="">
					</div>
					<img class="circle responsive-img" src="images/icn-app.png" alt="">
				</div>
			</li>
            <li><a href="negocios.html"><i class="fa fa-shopping-cart turqoise"></i>Negocios</a></li>
            <li><a href="promociones.html"><i class="fa fa-dollar turqoise"></i>Promociones</a></li>
            <li><a href="capacitacion.html"><i class="fa fa-spinner wizteria"></i>Capacitaci&oacute;n</a></li>
            <li><a href="empleo.html"><i class="fa fa-users belize"></i>Bolsa de Trabajo</a></li>
			<li><a href="sign-in.html" id="lnkUsuario"><i class="fa fa-sign-in belize"></i>Iniciar Sesi&oacute;n</a></li>
			<li><a href="sign-up.html"><i class="fa fa-user-plus wizteria"></i>Registrarme</a></li>
			<li id="logout"><a href="index.html"><i class="fa fa-share carrot"></i>Cerrar Sesi&oacute;n</a></li>
		</ul>
	</div>
	<!-- end sidebar -->

	<!-- pricing table -->
	<div class="segments-page">
		<div class="container">
			<div class="pricing-table">
				<div class="pages-title">
					<h3>Negocios</h3>
					<div class="line"></div>
				</div>
				<div class="row" id="negocios">
					
					
				</div>
			</div>
		</div>
	</div>
    
    <div style="display:none;">
    <form id="test" name="test" method="post">
<input type="hidden" id="tipo" name="tipo" readonly value="cata-neg"><br>
<input type="hidden" id="valor" name="valor" readonly ><br>
        </form>
    </div>
	<!-- end pricing table -->

	<script src="js/jquery.min.js"></script>
	<script src="js/materialize.js"></script>
	<script src="js/owl.carousel.min.js"></script>
	<script src="js/main.js"></script>
<script src="js/aplicacion.js"></script>
    
    <script type="application/javascript">
	
		function enviar(cadena){
            var tipo = document.getElementById('tipo').value;
			$.ajax({
				type: "POST",
				url: "https://regularizate.org/api/",
				data: cadena,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function(data){
					
                    if(tipo=='cata-neg')
                        {
                            
                            document.getElementById('negocios').innerHTML = "";
                            var b = 0;
                            for(var i=0;i<data.length;i++)
                            {
                                var valor = data[i].valor,
                                    imagen = data[i].imagen;
                                
                                var indice = i;
                                
                                var activo = (i==0) ? 'active' : '';
                                b++;
                                catalogo(valor, imagen, b);
                            }
                        }
                    if(tipo=='cons-neg')
                        {
                            document.getElementById('negocios').innerHTML = "";
                            document.getElementById('negocios').innerHTML = "<div class=\"col-md-12\" style=\"padding-bottom:15px;\"><center><input type=\"button\" onclick=\"resetear()\" value=\"Borrar filtros\"></div></center>";
                            for(var i=0;i<data.length;i++)
                            {
                                var codigo = data[i].codigo,
                                    nombre = data[i].nombre,
                                    logotipo = data[i].logotipo,
                                    categoria = data[i].categoria,
                                    domicilio = data[i].domicilio,
                                    horario = data[i].horario,
                                    direccion = data[i].direccion,
                                    descripcion = data[i].descripcion,
                                    fotos = data[i].fotos,
                                    web = data[i].web;
                                    
                                myFunction(codigo,logotipo, nombre, categoria, domicilio, direccion, fotos, web, horario,descripcion);
                            }
                        }
                    
				},
				failure: function(errMsg) {
					alert('Error al obtener los datos.\nComprueba tu enlace a internet');
				}
			});
		}
		
		function toJSONString( form ,res) {
  		var form1 = document.getElementById(form);
		var obj = {};
		var elements = form1.querySelectorAll( "input, select, textarea" );
		for( var i = 0; i < elements.length; ++i ) {
			var element = elements[i];
			var name = element.name;
			var value = element.value;

			if( name ) {
				obj[ name ] = value;
			}
		}
			
			enviar(JSON.stringify( obj ));
            
	}
        
        function myFunction(codigo,logotipo, nombre, categoria, domicilio, direccion, fotos, web, horario,descripcion) {
    
            var destino = document.getElementById('negocios');
            
            var contenido = '';
            
            contenido += '<a href="#" onclick="buscarNegocio(\''+codigo+'\')">';
            contenido += '<div class="contents">';
			contenido += '	<div class="list-img">';
			contenido += '		<img src="'+logotipo+'" alt="">';
			contenido += '	</div>';
			contenido += '	<div class="list-text">';
			contenido += '		<h6>'+nombre+'</h6>';
			contenido += '		<p>'+direccion+'</p>';
			contenido += '	</div>';
			contenido += '</div>';
            contenido += '</a><br>';
            
    
    destino.innerHTML += contenido;
   
}
      
        function catalogo(valor, imagen, b) {
        var slider = document.getElementById("negocios");
            
            var contenido = '';
            
            contenido += '<div class="col s6">';
            contenido += '<a href="#" onclick="seccion(\''+valor+'\',\'cons-neg\')">';
			contenido += '	<div class="contents z-depth-1 center">';
			contenido += '		<img src="'+imagen+'" alt="Regularizate" class="img-responsive" style="max-width:110px; max-height:110px;">';
			contenido += '		<h4><span>'+valor+'</span></h4>';
			contenido += '	</div>';
            contenido += '</a>';
			contenido += '</div>';
            
            if((b%2)==0)
                {
                    contenido += '<div class="row"></div>';
                }
            
    
        slider.innerHTML += contenido;
        }
        
        function seccion(valor, tipo){
          document.getElementById('tipo').value = tipo;
          document.getElementById('valor').value = valor;
          
          
          
          toJSONString('test','res');
      }
      
        function resetear(){
          document.getElementById('tipo').value = "cata-neg";
          document.getElementById('valor').value = "";
          window.location="negocios.html";
          toJSONString('test','res');
      }
        
        toJSONString('test','res');
        validarUsuario();
	
	</script>
</body>
</html>